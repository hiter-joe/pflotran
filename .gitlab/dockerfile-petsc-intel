FROM ubuntu:jammy

ENV PETSC_DIR=/scratch/petsc PETSC_ARCH=petsc-arch
ARG PETSC_VERSION

RUN apt update -qq && \
    apt install -y git make cmake lcov
RUN apt install -y python3 python3-h5py
RUN apt install -y wget
RUN apt install -y vim

WORKDIR /scratch
RUN wget https://www.mpich.org/static/downloads/4.1/mpich-4.1.tar.gz

RUN wget -O- https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB
RUN echo "deb [signed-by=/usr/share/keyrings/oneapi-archive-keyring.gpg] https://apt.repos.intel.com/oneapi all main"
RUN apt update -qq
RUN apt install -y \
    intel-oneapi-compiler-dpcpp-cpp-and-cpp-classic-common-2023.1.0 \
    intel-oneapi-compiler-fortran-2023.1.0 \
    intel-oneapi-mpi-devel-2021.9.0

COPY ./.gitlab/build-petsc.sh .
RUN /scratch/build-petsc-intel.sh


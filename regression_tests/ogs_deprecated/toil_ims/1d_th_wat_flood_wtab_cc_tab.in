# thermal water flood problem 
SIMULATION
  SIMULATION_TYPE SUBSURFACE
  !SIMULATION_TYPE GEOMECHANICS_SUBSURFACE
  PROCESS_MODELS
    SUBSURFACE_FLOW Flow
      MODE TOIL_IMS
      OPTIONS
      /
    / ! end of subsurface_flow
  / ! end of process models
END  !! end simulation 

SUBSURFACE

#=========================== numerical methods ================================
NUMERICAL_METHODS FLOW

  TIMESTEPPER
    TS_ACCELERATION 8
  /

  NEWTON_SOLVER
    ATOL 1D-12
    RTOL 1D-8
    STOL 1D-30
    DTOL 1D15
    ITOL 1D-8
    MAXIMUM_NUMBER_OF_ITERATIONS 25
    MAXF 100
    MAXIMUM_PRESSURE_CHANGE 5.D4
    ANALYTICAL_JACOBIAN
  /

END

#=========================== regression =======================================
REGRESSION
  CELL_IDS
    1
    2
    3
    30
  /
END
#=========================== discretization ===================================
GRID
  TYPE structured
  ORIGIN 0.d0 0.d0 0.d0
  NXYZ 30 1 1 
  BOUNDS
    0.d0 0.0 0.0 
    900.d0 10.d0 10.d0
  /
END

#=========================== solver options ===================================


#=========================== times ============================================
TIME
  FINAL_TIME 2000.0d0 d
  !FINAL_TIME 20000.0d0 d
  INITIAL_TIMESTEP_SIZE 1.0d-6 d
  MAXIMUM_TIMESTEP_SIZE 0.5d0 d at 0. d
  MAXIMUM_TIMESTEP_SIZE 20.d0 d at 20. d
/

#=========================== output options ===================================
skip
OUTPUT
  MASS_BALANCE_FILE
    PERIODIC TIMESTEP 1
  END
END

OUTPUT
  TIMES d 0.0 0.1 0.9 1.0 5.0 20.0 27.0 100.0 200.0 300.0 500.0 730.0 1095.0 \
          1460.0 1825.0 2000. 3000. 5000. 6000. 7000. 8000.0 9000.0 10000. \
          11000. 12000. 13000. 14000. 15000. 16000. 17000. 18000. 19000.
  VARIABLES
    TEMPERATURE
    LIQUID_PRESSURE
    LIQUID_SATURATION
    LIQUID_DENSITY
    LIQUID_MOBILITY
    LIQUID_ENERGY
    LIQUID_VISCOSITY
    OIL_PRESSURE
    OIL_SATURATION
    OIL_DENSITY
    OIL_MOBILITY
    OIL_ENERGY
    OIL_VISCOSITY
    CAPILLARY_PRESSURE
    POROSITY
    PERMEABILITY_X
    PERMEABILITY_Y
    PERMEABILITY_Z
  END
  FORMAT HDF5
  MASS_BALANCE 
END
noskip


#=========================== material properties ==============================
MATERIAL_PROPERTY formation
  ID 1
  POROSITY 0.33d0
  TORTUOSITY 1.d0
  ROCK_DENSITY 2.350d3
  SPECIFIC_HEAT 1.0d3
  THERMAL_CONDUCTIVITY_DRY 1.541d0
  THERMAL_CONDUCTIVITY_WET 1.541d0 
  !SOIL_COMPRESSIBILITY_FUNCTION DEFAULT
  !SOIL_COMPRESSIBILITY_FUNCTION BRAGFLO
  SOIL_COMPRESSIBILITY_FUNCTION QUADRATIC
  SOIL_COMPRESSIBILITY 4.934d-10 ! 1/Pa
  SOIL_REFERENCE_PRESSURE 1.0132D5
  CHARACTERISTIC_CURVES ch1
  PERMEABILITY
    PERM_X 3.35553922d-12
    PERM_Y 3.35553922d-12
    PERM_Z 6.71107844d-13
  /
/

#=========================== saturation functions =============================

CHARACTERISTIC_CURVES ch1
  PC_OW_TABLE swfn_table
  KRW_TABLE swfn_table
  KROW_TABLE sof2_table
  !cc tables
  TABLE swfn_table
    PRESSURE_UNITS Pa
    EXTERNAL_FILE swfn_table_1d_th.dat
  END
  TABLE sof2_table
   EXTERNAL_FILE sof2_table_1d_th.dat
  END
/

#=========================== EOSs =============================================

EOS WATER
  SURFACE_DENSITY 1000.0 kg/m^3
  WATERTAB
    DATA
      TEMPERATURE 80.0
	100	1.0287414849	0.3512414504
	120	1.0279295744	0.3512414504
	140	1.0271183046	0.3512414504
	160	1.0263076751	0.3512414504
	180	1.0254976853	0.3512414504
	200	1.0246883349	0.3512414504
	220	1.0238796232	0.3512414504
	240	1.0230715497	0.3512414504
	260	1.022264114	0.3512414504
	280	1.0214573156	0.3512414504
	300	1.0206511539	0.3512414504
      END !end TEMP block
      TEMPERATURE 110.0
	100	1.0512403407	0.2570502462
	120	1.0504106734	0.2570502462
	140	1.0495816609	0.2570502462
	160	1.0487533027	0.2570502462
	180	1.0479255983	0.2570502462
	200	1.0470985471	0.2570502462
	220	1.0462721487	0.2570502462
	240	1.0454464024	0.2570502462
	260	1.0446213079	0.2570502462
	280	1.0437968645	0.2570502462
	300	1.0429730718	0.2570502462
      END
      TEMPERATURE 140.0
	100	1.0794830162	0.2021306984
	120	1.078631059	0.2021306984
	140	1.0777797743	0.2021306984
	160	1.0769291614	0.2021306984
	180	1.0760792198	0.2021306984
	200	1.075229949	0.2021306984
	220	1.0743813485	0.2021306984
	240	1.0735334177	0.2021306984
	260	1.0726861561	0.2021306984
	280	1.0718395632	0.2021306984
	300	1.0709936385	0.2021306984
      END
      TEMPERATURE 170.0
	100	1.1143099297	0.1661666009
	120	1.1134304862	0.1661666009
	140	1.1125517368	0.1661666009
	160	1.1116736809	0.1661666009
	180	1.110796318	0.1661666009
	200	1.1099196475	0.1661666009
	220	1.109043669	0.1661666009
	240	1.1081683817	0.1661666009
	260	1.1072937853	0.1661666009
	280	1.1064198792	0.1661666009
	300	1.1055466627	0.1661666009
      END
      TEMPERATURE 200.0
	100	1.1574008781	0.1407939584
	120	1.156487426	0.1407939584
	140	1.1555746949	0.1407939584
	160	1.1546626842	0.1407939584
	180	1.1537513932	0.1407939584
	200	1.1528408214	0.1407939584
	220	1.1519309683	0.1407939584
	240	1.1510218333	0.1407939584
	260	1.1501134157	0.1407939584
	280	1.1492057152	0.1407939584
	300	1.148298731	0.1407939584
      END
    END !endDATA  
  END !end of WaterTab
END

EOS OIL
  SURFACE_DENSITY 995.98 kg/m^3 !not used in this dataset as no wells
  !heavy oil
  FORMULA_WEIGHT 508.0d0
  DENSITY INVERSE_LINEAR ! den = den0 / [1- C(p-p1)] [1 + E(t-t1)]
    REFERENCE_VALUE 995.98d0            !den0 [kg/m3]  
    PRES_REF_VALUE 1.013d5              !p1 [Pa]
    TEMP_REF_VALUE 15.6d0               !t1 [°C]
    COMPRESS_COEFF 5.63d-10            !C [1/Pa]
    THERMAL_EXPANSION_COEFF 8.480d-4   !E [1/°C]
  END
  ENTHALPY QUADRATIC_TEMP ! h = c1*(t-t1) + 0.5*c2*(t-t2)
    TEMP_REF_VALUES 15.6d0  15.6d0     !t1, t2 [°C]
    TEMP_COEFFICIENTS 2.224D3 0.0d0  !c1, c2 [J/kg/°C]
  END
  ! vis = vis0 + a1(p-p1) + a2(p-p2)^2 + b1(t-t1) + b2(t-t2)^2 
  VISCOSITY QUADRATIC 
    REFERENCE_VALUE 0.267627d0    !vis0  [Pa.s]
    PRES_REF_VALUES 1.d5 0.0      !p1, p2 [Pa]
    TEMP_REF_VALUES 80.0  0.0    !t1, t2 [°C]
    PRES_COEFFICIENTS 0.0d0 0.0d0        !a1,a2 [kg/m3/Pa], a2 [..]
    TEMP_COEFFICIENTS -1.83989d-3 0.0d0  !b1,b2 [kg/m3/°C], b2 [..]
  END
END

#=========================== regions ==========================================
REGION all
  COORDINATES
    0.d0 0.d0 0.d0
    900.d0 10.d0 10.d0
  /
END

REGION west_inj
  FACE WEST
  COORDINATES
    0.d0 0.d0 0.d0
    0.d0 10.d0 10.d0
  /
END

REGION east_prod
  FACE EAST
  COORDINATES
    900.d0 0.d0 0.d0
    900.d0 10.d0 19.d0
  /
END

#=========================== flow conditions ==================================
FLOW_CONDITION initial_press
  !UNITS Pa,C,M,yr
  TYPE
    PRESSURE dirichlet
    OIL_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  PRESSURE 200.0 Bar 
  OIL_SATURATION 0.85d0 !With this accounts for connate water 
  TEMPERATURE 80.0d0 C  !up to here it refers to primary vars
/

FLOW_CONDITION inject_press
  !UNITS Pa,C,M,yr
  TYPE
    PRESSURE dirichlet
    OIL_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  PRESSURE 30.0D6 Pa !300bars 
  OIL_SATURATION 0.15d0 !model a water injector
  TEMPERATURE 200.0d0 C
/

FLOW_CONDITION prod_press
  !UNITS Pa,C,M,yr
  TYPE
    PRESSURE dirichlet
    OIL_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  PRESSURE 200.0 Bar 
  OIL_SATURATION 0.65d0 !model a well with water and oil  both mobile
  TEMPERATURE 80.0d0 C  !up to here it refers to primary vars
/



#=========================== condition couplers ===============================
# initial condition
INITIAL_CONDITION
  FLOW_CONDITION initial_press
  REGION all
END

!note the water breakthrough cannot be modeled - well needed
BOUNDARY_CONDITION outlet
  !FLOW_CONDITION initial_press
  FLOW_CONDITION prod_press
  REGION east_prod
END

# water injector
BOUNDARY_CONDITION press_wat_inj
  FLOW_CONDITION inject_press
  REGION west_inj
END

#=========================== stratigraphy couplers ============================
STRATA
  REGION all
  MATERIAL formation
END

END_SUBSURFACE

